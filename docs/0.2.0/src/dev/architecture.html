

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Rafiki’s Architecture &mdash; Rafiki  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Folder Structure" href="folder-structure.html" />
    <link rel="prev" title="Users of Rafiki" href="user-types.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Rafiki
          

          
          </a>

          
            
            
              <div class="version">
                0.2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">User Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Developer Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="setup.html">Setup &amp; Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="development.html">Development</a></li>
<li class="toctree-l2"><a class="reference internal" href="user-types.html">Users of Rafiki</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Rafiki’s Architecture</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#static-stack-of-rafiki">Static Stack of Rafiki</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dynamic-stack-of-rafiki">Dynamic Stack of Rafiki</a></li>
<li class="toctree-l3"><a class="reference internal" href="#container-orchestration-strategy">Container Orchestration Strategy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#distributed-file-system-strategy">Distributed File System Strategy</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="folder-structure.html">Folder Structure</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../python/index.html">Python Documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Rafiki</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Developer Guide</a> &raquo;</li>
        
      <li>Rafiki’s Architecture</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/src/dev/architecture.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="rafiki-s-architecture">
<span id="architecture"></span><h1>Rafiki’s Architecture<a class="headerlink" href="#rafiki-s-architecture" title="Permalink to this headline">¶</a></h1>
<p>Rafiki’s system architecture consists of 3 static components, 2 central databases, 4 types of dynamic components, and 1 client-side SDK,
which can be illustrated with a 3-layer architecture diagram.</p>
<div class="figure align-center" id="id1">
<a class="reference internal image-reference" href="../../_images/container-diagram.png"><img alt="../../_images/container-diagram.png" src="../../_images/container-diagram.png" style="width: 1200px;" /></a>
<p class="caption"><span class="caption-text">Architecture of Rafiki</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<div class="section" id="static-stack-of-rafiki">
<h2>Static Stack of Rafiki<a class="headerlink" href="#static-stack-of-rafiki" title="Permalink to this headline">¶</a></h2>
<p>Rafiki’s static stack consists of the following:</p>
<blockquote>
<div><p><em>Rafiki Admin</em> (<em>Python/Flask</em>) is the centrepiece of Rafiki. It is a multi-threaded HTTP server which presents a unified REST API over HTTP that fully administrates the Rafiki instance. When users send requests to Rafiki Admin, it handles these requests by accordingly modifying Rafiki’s Metadata Store or deploying/stopping the dynamic components of Rafiki’s stack (i.e. workers for model training &amp; serving).</p>
<p><em>Rafiki Metadata Store</em> (<em>PostgreSQL</em>) is Rafiki’s centralized, persistent database for user metadata, job metadata, worker metadata and model templates.</p>
<p><em>Rafiki Cache</em> (<em>Redis</em>) is Rafiki’s temporary in-memory store for the implementation of fast asynchronous cross-worker communication, in a way that decouples senders from receivers. It synchronizes the back-and-forth of queries &amp; predictions between multiple Rafiki Inference Workers and a single Rafiki Predictor for an Inference Job.</p>
<p><em>Rafiki Web Admin</em> (<em>NodeJS/ExpressJS</em>) is a HTTP server that serves Rafiki’s web front-end to users, allowing Application Developers to survey their jobs on a friendly web GUI.</p>
<p><em>Rafiki Client</em> (<em>Python</em>) is Rafiki’s client-side Python SDK to simplify communication with Admin.</p>
</div></blockquote>
</div>
<div class="section" id="dynamic-stack-of-rafiki">
<h2>Dynamic Stack of Rafiki<a class="headerlink" href="#dynamic-stack-of-rafiki" title="Permalink to this headline">¶</a></h2>
<p>On the other hand, Rafiki’s dynamic stack consists of a dynamic pool of workers.
Internally within Rafiki’s architecture, Admin adopts master-slave relationships with these workers, managing the deployment and termination of these workers in real-time depending on Train Job and Inference Job requests, as well as the stream of events it receives from its workers.
When a worker is deployed, it is configured with the identifier for an associated job, and once it starts running, it would first initialize itself by pulling the job’s metadata from Metadata Store before starting on its task.</p>
<p>The types of workers are as follows:</p>
<blockquote>
<div><p><em>Rafiki Advisor Workers</em> (<em>Python</em>) proposes knobs &amp; training configuration for Train Workers. For each model, there is a single Advisor Worker centrally orchestrating tuning of the model together with multiple Train Workers.</p>
<p><em>Rafiki Train Workers</em> (<em>Python</em>) train models for Train Jobs by conducting Trials.</p>
<p><em>Rafiki Predictors</em> (<em>Python/Flask</em>) are multi-threaded HTTP servers that receive queries from Application Users and respond with predictions as part of an Inference Job. It does this through  producer-consumer relationships with multiple Rafiki Inference Workers. If necessary, it performs model ensembling on predictions received from different workers.</p>
<p><em>Rafiki Inference Workers</em> (<em>Python</em>) serve models for Inference Jobs. In a single Inference Job, there could be multiple Inference Workers concurrently making predictions for a single batch of queries.</p>
</div></blockquote>
</div>
<div class="section" id="container-orchestration-strategy">
<h2>Container Orchestration Strategy<a class="headerlink" href="#container-orchestration-strategy" title="Permalink to this headline">¶</a></h2>
<p>All of Rafiki’s components’ environment and configuration has been fully specified as a replicable, portable Docker image publicly available as Dockerfiles and on <a class="reference external" href="https://hub.docker.com/u/rafikiai">Rafiki’s own Docker Hub account</a>.</p>
<p>When an instance of Rafiki is deployed on the master node, a <a class="reference external" href="https://docs.docker.com/engine/swarm/key-concepts/">Docker Swarm</a> is initialized and all of Rafiki’s components run within a single <a class="reference external" href="https://docs.docker.com/network/overlay/">Docker routing-mesh overlay network</a>.
Subsequently, Rafiki can be horizontally scaled by adding more worker nodes to the Docker Swarm. Dynamically-deployed workers run as <a class="reference external" href="https://docs.docker.com/engine/swarm/services/">Docker Swarm Services</a>
and are placed in a resource-aware manner.</p>
</div>
<div class="section" id="distributed-file-system-strategy">
<h2>Distributed File System Strategy<a class="headerlink" href="#distributed-file-system-strategy" title="Permalink to this headline">¶</a></h2>
<p>All components depend on a shared file system across multiple nodes, powered by <em>Network File System</em> (<em>NFS</em>).
Each component written in Python continually writes logs to this shared file system.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="folder-structure.html" class="btn btn-neutral float-right" title="Folder Structure" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="user-types.html" class="btn btn-neutral float-left" title="Users of Rafiki" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, nginyc, cadmusthefounder, nudles

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>